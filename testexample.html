<!DOCTYPE html>
<html>
<head>

  <title>anbado player example</title>
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
  
  <script src="http://popcornjs.org/code/dist/popcorn-complete.js"></script>
  <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.createjs.com/easeljs-0.6.1.min.js"></script>
  <script src="http://localhost:8888/socket.io/socket.io.js"></script>
  <link rel="stylesheet" type="text/css" href="basiccss.css">
  <script type="text/javascript">



  // var socket = io.connect('http://localhost:8888');
  var socket;
  jQuery(function() {
    socket = io.connect("http://localhost:8888/");

    socket.on('connect', function() {
      socket.on('return', function(data) {
        console.log(data);
      });

      socket.emit('sample', {hello: 'world'});
    });
  });
  // socket.on('connect', function (data) {
  //   console.log(data);
  //   socket.emit('my other event', { my: 'data' });
  //   socket.on('return', function(data) {console.log(data)})
  // });

    var popcornobject; // global access video object 

    var canvaslayer; // canvas overlay
    var canvas_bar;

    var container;
    var stage;
    var stage_bar;
    var time_posision=0; 



    document.addEventListener( "DOMContentLoaded", function() {
      popcornobject = Popcorn("#ourvideo"); // 팝콘 객체 생성
     
      popcornobject.on("play", function() {
        console.log("Playing!");
        
        popcornobject.on("timeupdate", function(){
          time_posision=(this.currentTime()/this.duration());
          
          socket.emit('sample',{hello: popcornobject.currentTime()});
        
        });

      });

      canvaslayer = document.getElementById("canvas1");
      stage = new createjs.Stage(canvaslayer);
      canvas_bar=document.getElementById("canvas2");
      stage_bar = new createjs.Stage(canvas_bar);


      container = new createjs.Container();
      container.x=0;
      container.y=0;

      
      console.log($("#textinput1").val());
      //socket io 부분 테스팅 

      //offset 값으로 나중에 수정 vidio의 위치 
$("#canvas1").css({"top":100,"left":240});
$("#canvas2").css({"top":600,"left":240});
$("#ourvideo").css({"top":100,"left":240});
$("#textinput1").css({"top":100,"left":240});
$("#textbutton1").css({"top":100,"left":240});

    $("input:text").hide();
    $("input:submit").hide();
    


      stage.onMouseDown = displayInputPanel; // on mouse click - input event occur. onClick won't work
      // alert(stage.mouseY);
      // stage.update();
      // alert(stage.mouseY);
      // stage.update();
    });



    function eventGenerate(clicktime, posx, poxy){ // video interaction event generation 
      var eventObjcet = new Object();
      eventObject.eventID = 0; 
      eventObject.eventVideoClickPoint = clicktime;
      eventObject.eventPosX = posx;  // 화면의 디스플레이를 표시하도록
      eventObject.eventPosY = posy; 
      eventObject.eventVideoClickDuration = 0; 
      evententObject.eventOccuredTime = 0; 
      eventObject.eventType = "text"; // event type e.g text, image,, webcam
      eventObject.eventContent = "event content";  
    }

function displayInputPanel(evt){

  //alert("in display");
  console.log("in display");
  
    $("input:text").show();
    $("input:submit").show();
  var textInputField = new createjs.DOMElement("textinput1");
  var textInputButton = new createjs.DOMElement("textbutton1");
  console.log(textInputField);

  textInputField.regX = -100;
  textInputField.regY = 0;

  textInputField.x = stage.mouseX;
  //alert(textInputField.x + " " + stage.mouseX);
  textInputField.y = stage.mouseY;
  textInputButton.regX = -300; 
  textInputButton.regY = 0; 
  textInputButton.x = stage.mouseX;
  textInputButton.y = stage.mouseY;
  
 

  var frame = new createjs.Shape();
  frame.graphics.beginFill("#00F").drawRect(stage.mouseX,stage.mouseY,28,28);
  

  
      // container.addChild(textInputField, submitbutton1, frame);
      stage.addChild(textInputField);
      stage.addChild(textInputButton);
      stage.addChild(frame);
      // stage.addChild($container);

      stage.update();


    }

    function savetext()
    {
      alert("savetext");
    }

    function happybutton()
    {
    
 var target = new createjs.Shape();
      target.graphics.beginFill("rgba(255,0,0,1)").drawRect(640*time_posision,0,5,50);
console.log(time_posision+"%");

          container.addChild(target);
          stage_bar.addChild(container);

          stage_bar.update();

    }

       function sadbutton()
    {
    
 var target = new createjs.Shape();
      target.graphics.beginFill("rgba(0,255,0,1)").drawRect(640*time_posision,0,5,50);
console.log(time_posision+"%");

          container.addChild(target);
          stage_bar.addChild(container);

          stage_bar.update();
    }

    
    </script>
    
  </head>
  <body>
    <div>
      <video id="ourvideo" controls="false">
        <source src="http://videos.mozilla.org/serv/webmademovies/popcornplug.mp4"/>
        <source src="http://videos.mozilla.org/serv/webmademovies/popcornplug.ogv"/>
        <source src="http://videos.mozilla.org/serv/webmademovies/popcornplug.webm"/>
      </video>
      <div id="canvascontainer">
        <canvas id="canvas1" width = "640px" height = "430px"></canvas>
        <canvas id="canvas2"width = "640px" height = "50px"></canvas>
      </div>

    </div>

    
    

    <div id="testdiv">
      <p>div tesing </p>
    </div>


    <input id="textinput1" name="nowfeel" type = "text" value="지금 당신의 생각을 남기세요" />
    <input id="textbutton1" type = "submit" value= "now"/> 

    <input id="happy1" type = "button" onclick="happybutton()" value= "happy" /> 
   <input id="sad1" type = "button" onclick="sadbutton()" value= "sad" /> 
  


  </body>
  </html>