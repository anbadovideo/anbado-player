<!DOCTYPE html>
<html>
<head>

  <title>anbado player example</title>
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
  
  <script src="http://popcornjs.org/code/dist/popcorn-complete.js"></script>
  <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.createjs.com/easeljs-0.6.1.min.js"></script>
  <script src="http://localhost:8888/socket.io/socket.io.js"></script>
  <link rel="stylesheet" type="text/css" href="basiccss.css">
  <script type="text/javascript">


  // var socket = io.connect('http://localhost:8888');

// document.onkeydown = function (evt) {
//   var keyCode = evt ? (evt.which ? evt.which : evt.keyCode) : event.keyCode;
//   if (keyCode == 13) {
//     // For Enter.
//     alert("df");
//     // Your function here.
//   }
//   if (keyCode == 27) {
//     // For Escape.
//     // Your function here.
//   } else {
//     return true;
//   }
// };



  var socket;
  jQuery(function() {
    socket = io.connect("http://localhost:8888/");

    socket.on('connect', function() {
      socket.on('return', function(data) {
        console.log(data);
      });

      socket.emit('sample', {hello: 'world'});
    });
  });
  // socket.on('connect', function (data) {
  //   console.log(data);
  //   socket.emit('my other event', { my: 'data' });
  //   socket.on('return', function(data) {console.log(data)})
  // });

    var popcornobject; // global access video object 
    var totalEvent =0; // total event number
    var currentEventPosition = 0; 

    var canvaslayer; // canvas overlay
    var canvas_bar;

    var container;
    var stage;
    var stage_bar;
    var time_posision=0; 

    var eventList = new Array();





    document.addEventListener( "DOMContentLoaded", function() {







      popcornobject = Popcorn("#ourvideo"); // 팝콘 객체 생성

      popcornobject.on("play", function() {
        console.log("Playing!");
        
        popcornobject.on("timeupdate", function(){

          if(((this.currentTime()-eventList[currentEventPosition].eventVideoClickTime)>=eventList[currentEventPosition].eventVideoClickDuration)||(this.currentTime()==this.duration()))   // 같거나 비디오가 끝나면 디스플레이를 없애준다. 
          {
            $("input:text").hide();
            $("input:submit").hide();
          }
          console.log("this time:"+this.currentTime());

        }); 

          // socket.emit('sample',{hello: popcornobject.currentTime()});

        });

      

      canvaslayer = document.getElementById("canvas1");
      stage = new createjs.Stage(canvaslayer);
      canvas_bar=document.getElementById("canvas2");
      stage_bar = new createjs.Stage(canvas_bar);


      container = new createjs.Container();
      container.x=0;
      container.y=0;

      
      console.log($("#textinput1").val());
      //socket io 부분 테스팅 

      //offset 값으로 나중에 수정 vidio의 위치 
      $("#canvas1").css({"top":100,"left":240});
      $("#canvas2").css({"top":600,"left":240});
      $("#ourvideo").css({"top":100,"left":240});
      $("#textinput1").css({"top":100,"left":240});
      $("#textbutton1").css({"top":100,"left":240});

      $("input:text").hide();
      $("input:submit").hide();


      enterKeyInit(); // DOM을 넘겨줘서 실행하는 것으로 



      stage.onMouseDown = eventGenerate; // on mouse click - input event occur. onClick won't work
      // alert(stage.mouseY);
      // stage.update();
      // alert(stage.mouseY);
      // stage.update();
    });



    function eventGenerate(evt){ // video interaction event generation 
      var eventObject = new Object();
      eventObject.eventID = totalEvent++; 
      eventObject.eventVideoClickTime = popcornobject.currentTime(); // 플레어에서의 currentTime을 받는 것으로 
      eventObject.eventOccuredAbsoluteTime = 0; // 이벤트가 생성된 현재 시간. 
      eventObject.eventVideoClickDuration = 2; // 얼마나 지속되는지 
      eventObject.eventPosX = stage.x;  // 화면의 디스플레이를 표시하도록
      eventObject.eventPosY = stage.y; 
      eventObject.timelineOffset;  // 타임라인에서 얼마나 떨어져 있는가?       
      eventObject.eventType = "text"; // event type e.g text, emoticon, image, buttonaction, webcam
      eventObject.eventContent = "event content";  
      eventObject.secUnit = 100* Math.round(popcornobject.currentTime() / popcornobject.duration());// 몇번째 유닛인지? 
      // console.log(eventObject);

      eventList.push("eventObject"); 
      displayInputPanel();

    }

    function displayInputPanel(){ // on first screen, display text input panel, submit button, emoticon panel

      $("input:text").show();
      $("input:submit").show();
      var textInputField = new createjs.DOMElement("textinput1");
      var textInputButton = new createjs.DOMElement("textbutton1");

      textInputField.regX = 0;
      textInputField.regY = 0;

      textInputField.x = stage.mouseX;
      textInputField.y = stage.mouseY;

      textInputButton.regX = -180; 
      textInputButton.regY = 0; 
      textInputButton.x = stage.mouseX;
      textInputButton.y = stage.mouseY;
      stage.addChild(textInputField);
      stage.addChild(textInputButton);
      
  

      stage.update();


      if(popcornobject.currentTime()==popcornobject.duration())// check video end
      {      
        $("input:text").hide();
        $("input:submit").hide(); 
     // 동영상이 끝나고 클릭했을 경우 입력 패널이 뜨는 문제점을 방지하기 위해 
      }


   //  function click_video_canvas(mousex,mousey)
   //  {

   //    var textInputField = new createjs.DOMElement("textinput1");
   //    var textInputButton = new createjs.DOMElement("textbutton1");


   //    textInputField.regX = -100;
   //    textInputField.regY = 0;

   //    textInputField.x = mousex;
   //    textInputField.y = mousey;
   //    textInputButton.regX = -300; 
   //    textInputButton.regY = 0; 
   //    textInputButton.x = mousex;
   //    textInputButton.y = mousey;
  
   //    $("input:text").show();
   //    $("input:submit").show();
   //    stage.addChild(textInputField);
   //    stage.addChild(textInputButton);
 
   //    stage.update();

   //    if(popcornobject.currentTime()==popcornobject.duration())// check video end
   //     {      $("input:text").hide();
   //   $("input:submit").hide(); 
   //   // 동영상이 끝나고 클릭했을 경우 입력 패널이 뜨는 문제점을 방지하기 위해 
   // } 


    }


function enterKeyInit(){

  $("#textinput1").keypress(function(evt) {
  if(evt.keyCode == 13){alert("13");}
  // console.log("Handler for .keypress() called.");
});

}

    function happybutton()
    {

     var target = new createjs.Shape();
     target.graphics.beginFill("rgba(255,0,0,1)").drawRect(640*time_posision,0,5,50);
     console.log(time_posision+"%");

     container.addChild(target);
     stage_bar.addChild(container);

     stage_bar.update();

   }

   function sadbutton()
   {

     var target = new createjs.Shape();
     target.graphics.beginFill("rgba(0,255,0,1)").drawRect(640*time_posision,0,5,50);
     console.log(time_posision+"%");

     container.addChild(target);
     stage_bar.addChild(container);

     stage_bar.update();
   }

   function savetext()
   {
    // alert("text on");
   }


   </script>

 </head>
 <body>
  <div>
    <video id="ourvideo" controls="false">
      <source src="http://videos.mozilla.org/serv/webmademovies/popcornplug.mp4"/>
      <source src="http://videos.mozilla.org/serv/webmademovies/popcornplug.ogv"/>
      <source src="http://videos.mozilla.org/serv/webmademovies/popcornplug.webm"/>
    </video>
    <div id="canvascontainer">
      <canvas id="canvas1" width = "640px" height = "430px"></canvas>
      <canvas id="canvas2"width = "640px" height = "50px"></canvas>
    </div>

  </div>

  <input id="textinput1" type = "text" value = "input" onkeypress="savetext()">
  <input id="textbutton1" type = "submit" value= "now"/> 


  <input id="textinput2" type = "text" value = "ass">
  <input id="textbutton2" type = "submit" value= "now"/> 


  <input id="happy1" type = "button" onclick="happybutton()" value= "happy" /> 
  <input id="sad1" type = "button" onclick="sadbutton()" value= "sad" /> 
  


</body>
</html>